---
import Layout from "../layouts/Layout.astro";
import { BookingModal } from "../components/react/Modals";

const web3formsKey = import.meta.env.PUBLIC_WEB3FORMS_KEY || "";

const siteUrl = Astro.site?.href || "https://astro-blog-five-zeta.vercel.app";
---

<Layout
  title="Contact Us"
  description="Ready to start a project or have questions about our estimating services? Send us a message or book a discovery call with our team."
>
  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "LocalBusiness",
      "name": "Unicalibre Estimating",
      "url": siteUrl,
      "email": "estimates@unicalibre.com",
      "telephone": "+1-555-012-3456",
      "description": "Professional quantity takeoff services for construction trades.",
      "openingHours": "Mo-Fr 08:00-18:00"
    })} />
  </Fragment>

  <div class="py-24 bg-white min-h-screen">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-16">

        <!-- Left Col: Contact Form -->
        <div>
          <div class="mb-8">
            <h1 class="text-4xl font-bold text-slate-900 mb-4">Get in Touch</h1>
            <p class="text-lg text-slate-600">
              Ready to start a project or have questions about our services? Send us a message or book a call.
            </p>
          </div>

          <form id="contact-form" action="https://api.web3forms.com/submit" method="POST" class="space-y-6 bg-slate-50 p-8 rounded-xl border border-slate-100 shadow-sm">
            <input type="hidden" name="access_key" value={web3formsKey} />
            <input type="hidden" name="subject" value="New Contact Form Submission - Unicalibre Estimating" />
            <input type="hidden" name="from_name" value="Unicalibre Estimating" />
            <input type="checkbox" name="botcheck" class="hidden" />

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="space-y-2">
                <label for="c-name" class="text-sm font-medium leading-none">Name</label>
                <input id="c-name" name="name" required placeholder="John Doe" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring" />
              </div>
              <div class="space-y-2">
                <label for="c-phone" class="text-sm font-medium leading-none">Phone</label>
                <input id="c-phone" name="phone" placeholder="(555) 123-4567" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring" />
              </div>
            </div>

            <div class="space-y-2">
              <label for="c-email" class="text-sm font-medium leading-none">Email</label>
              <input id="c-email" name="email" type="email" required placeholder="john@company.com" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring" />
            </div>

            <div class="space-y-2">
              <label for="c-company" class="text-sm font-medium leading-none">Company</label>
              <input id="c-company" name="company" placeholder="Your Company Name" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring" />
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div class="space-y-2">
                <label for="c-trade" class="text-sm font-medium leading-none">Trade</label>
                <select id="c-trade" name="trade" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
                  <option value="">Select Trade</option>
                  <option value="flooring">Flooring</option>
                  <option value="cabinet">Cabinet</option>
                  <option value="countertop">Countertop</option>
                  <option value="drywall">Drywall</option>
                  <option value="painting">Painting</option>
                  <option value="landscaping">Landscaping</option>
                  <option value="general">General Contractor</option>
                  <option value="other">Other</option>
                </select>
              </div>
              <div class="space-y-2">
                <label for="c-type" class="text-sm font-medium leading-none">Project Type</label>
                <select id="c-type" name="project_type" class="flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring">
                  <option value="">Select Type</option>
                  <option value="residential">Residential</option>
                  <option value="commercial">Commercial</option>
                  <option value="institutional">Institutional</option>
                </select>
              </div>
            </div>

            <div class="space-y-2">
              <label for="c-message" class="text-sm font-medium leading-none">Message</label>
              <textarea id="c-message" name="message" placeholder="Tell us about your needs..." rows="5" class="flex min-h-[120px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring resize-none"></textarea>
            </div>


            <button
              type="submit"
              id="contact-submit"
              class="w-full inline-flex items-center justify-center h-12 px-8 bg-primary text-primary-foreground text-lg font-bold rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors"
            >
              Send Message
            </button>
            <div id="contact-result" class="hidden rounded-lg px-4 py-3 text-sm font-medium"></div>
          </form>
        </div>

        <!-- Right Col: Booking + Info -->
        <div class="space-y-12">
          <!-- Booking Card -->
          <div class="bg-slate-900 text-white p-10 rounded-2xl shadow-xl">
            <h2 class="text-2xl font-bold mb-4 text-white">Skip the back-and-forth</h2>
            <p class="text-slate-300 mb-8">
              Book a 15-minute discovery call directly with our estimating lead. We'll discuss your project volume and how we can fit into your workflow.
            </p>
            <BookingModal
              client:load
              buttonText="Book Discovery Call"
              buttonClassName="w-full inline-flex items-center justify-center h-14 px-8 bg-secondary text-secondary-foreground text-lg font-bold rounded-md shadow-sm hover:bg-secondary/80 transition-colors"
            />
          </div>

          <!-- Contact Info -->
          <div>
            <h3 class="text-xl font-bold text-slate-900 mb-4">Contact Info</h3>
            <div class="space-y-4 text-slate-600">
              <p class="flex items-center gap-3">
                <span class="font-bold text-slate-900">Email:</span> estimates@unicalibre.com
              </p>
              <p class="flex items-center gap-3">
                <span class="font-bold text-slate-900">Phone:</span> (555) 012-3456
              </p>
              <p class="flex items-center gap-3">
                <span class="font-bold text-slate-900">Hours:</span> Mon-Fri, 8am - 6pm EST
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const form = document.getElementById("contact-form") as HTMLFormElement;
    const submitBtn = document.getElementById("contact-submit") as HTMLButtonElement;
    const result = document.getElementById("contact-result") as HTMLDivElement;

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      submitBtn.disabled = true;
      submitBtn.textContent = "Sending...";
      result.classList.add("hidden");

      try {
        const response = await fetch(form.action, {
          method: form.method,
          headers: { "Content-Type": "application/json", Accept: "application/json" },
          body: JSON.stringify(Object.fromEntries(new FormData(form))),
        });
        const data = await response.json();

        if (data.success) {
          result.textContent = "Message sent successfully! We'll get back to you soon.";
          result.className = "rounded-lg px-4 py-3 text-sm font-medium bg-green-50 text-green-700 border border-green-200";
          form.reset();
        } else {
          throw new Error(data.message || "Something went wrong.");
        }
      } catch (err: any) {
        result.textContent = err.message || "Failed to send message. Please try again.";
        result.className = "rounded-lg px-4 py-3 text-sm font-medium bg-red-50 text-red-700 border border-red-200";
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Send Message";
      }
    });
  </script>
</Layout>
