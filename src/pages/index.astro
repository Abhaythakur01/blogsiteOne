---
import Layout from "../layouts/Layout.astro";
import BlogCard from "../components/blog/BlogCard.astro";
import { getPosts } from "../lib/sanity";

const posts = await getPosts();
const featuredPost = posts[0];
const recentPosts = posts.slice(1, 7);

const web3formsKey = import.meta.env.PUBLIC_WEB3FORMS_KEY || "";
---

<Layout
  title="Latest Insights, Stories & Blog Categories"
  description="Explore the latest insights, stories, and blog categories from Unicalibre. Expert guides on estimating, construction, and business growth to keep you informed."
>
  <!-- Hero Section -->
  <section class="relative pt-24 pb-32 lg:pt-36 lg:pb-40 overflow-hidden tech-grid-bg">
    <div class="absolute inset-0 bg-gradient-to-b from-background via-background/80 to-background"></div>
    <div class="relative max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <p class="text-primary font-semibold uppercase tracking-wider mb-4">Unicalibre Blog — Insights & Knowledge</p>
      <h1 class="text-4xl md:text-5xl lg:text-7xl font-heading font-bold text-slate-900 mb-6 text-balance">
        Stories, Ideas &<br />
        <span class="text-primary">Expert Blog Insights</span>
      </h1>
      <p class="text-xl text-slate-600 max-w-2xl mx-auto mb-10">
        Discover the latest insights, industry trends, and company updates from our team of experts. Browse blog categories covering estimating, construction, and business growth.
      </p>
      <div class="flex flex-col sm:flex-row gap-4 justify-center">
        <a
          href="/blog"
          class="inline-flex items-center justify-center px-8 py-3.5 bg-primary text-primary-foreground font-semibold rounded-lg hover:bg-primary/90 transition-colors shadow-lg"
        >
          Read the Blog
        </a>
        <a
          href="/categories"
          class="inline-flex items-center justify-center px-8 py-3.5 border border-slate-300 text-slate-700 font-semibold rounded-lg hover:bg-slate-100 transition-colors"
        >
          Browse Categories
        </a>
      </div>
    </div>
  </section>

  <!-- Intro Section -->
  <section class="py-16 bg-white border-b border-slate-100">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="text-2xl font-heading font-bold text-slate-900 mb-4">Welcome to the Unicalibre Blog</h2>
      <p class="text-slate-600 leading-relaxed text-lg">
        Welcome to your home for the latest insights and stories from the Unicalibre team. We publish in-depth guides, expert opinions, and actionable advice across a range of blog categories — from estimating best practices and construction technology to business growth strategies and industry news. Whether you are a seasoned professional or just getting started, our content is designed to help you stay informed and make smarter decisions.
      </p>
    </div>
  </section>

  <!-- Featured Post -->
  {featuredPost && (
    <section class="py-16 bg-white">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <p class="text-slate-400 font-semibold uppercase tracking-wider text-sm mb-2">Featured</p>
        <h2 class="text-3xl font-bold text-slate-900 mb-8">Latest Highlight</h2>
        <BlogCard post={featuredPost} featured={true} />
      </div>
    </section>
  )}

  <!-- Recent Posts -->
  {recentPosts.length > 0 && (
    <section class="py-24 bg-slate-50 tech-grid-bg">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between mb-4">
          <h2 class="text-3xl font-bold text-slate-900">Latest Blog Posts</h2>
          <a href="/blog" class="text-primary hover:text-primary/80 font-semibold transition-colors">
            View all posts &rarr;
          </a>
        </div>
        <p class="text-slate-600 mb-10 max-w-2xl">
          Stay up to date with the latest stories and insights from our team. Each article is crafted to deliver practical value across our blog categories, helping you navigate industry changes with confidence.
        </p>
        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
          {recentPosts.map((post) => (
            <BlogCard post={post} />
          ))}
        </div>
      </div>
    </section>
  )}

  <!-- Newsletter CTA -->
  <section class="py-24 bg-primary text-white">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
      <h2 class="text-3xl md:text-4xl font-bold text-white mb-4">Stay Updated</h2>
      <p class="text-primary-foreground/90 mb-10 max-w-xl mx-auto text-lg">
        Subscribe to our newsletter and never miss an update. Get the latest insights delivered directly to your inbox.
      </p>
      <form id="newsletter-form" class="flex flex-col sm:flex-row gap-4 max-w-md mx-auto">
        <input type="hidden" name="access_key" value={web3formsKey} />
        <input type="hidden" name="subject" value="New Newsletter Subscriber - Unicalibre Blog" />
        <input type="hidden" name="from_name" value="Unicalibre Blog" />
        <input type="checkbox" name="botcheck" class="hidden" style="display:none" />
        <input
          type="email"
          name="email"
          placeholder="Enter your email"
          aria-label="Email address for newsletter"
          class="flex-1 px-4 py-3.5 rounded-lg bg-white text-slate-900 shadow-lg focus:outline-none focus:ring-2 focus:ring-white"
          required
        />
        <button
          type="submit"
          id="newsletter-submit"
          class="px-8 py-3.5 bg-white text-primary font-bold rounded-lg shadow-2xl hover:bg-slate-50 transition-colors"
        >
          Subscribe
        </button>
      </form>
      <p id="newsletter-result" class="hidden mt-4 text-sm font-medium"></p>
    </div>
  </section>

  <script>
    const form = document.getElementById("newsletter-form") as HTMLFormElement;
    const submitBtn = document.getElementById("newsletter-submit") as HTMLButtonElement;
    const result = document.getElementById("newsletter-result") as HTMLParagraphElement;

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      submitBtn.disabled = true;
      submitBtn.textContent = "Subscribing...";
      result.classList.add("hidden");

      try {
        const response = await fetch("https://api.web3forms.com/submit", {
          method: "POST",
          headers: { "Content-Type": "application/json", Accept: "application/json" },
          body: JSON.stringify(Object.fromEntries(new FormData(form))),
        });
        const data = await response.json();

        if (data.success) {
          result.textContent = "You're subscribed! Thanks for signing up.";
          result.className = "mt-4 text-sm font-medium text-white/90";
          form.reset();
        } else {
          throw new Error(data.message || "Something went wrong.");
        }
      } catch (err: any) {
        result.textContent = err.message || "Failed to subscribe. Please try again.";
        result.className = "mt-4 text-sm font-medium text-red-200";
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Subscribe";
      }
    });
  </script>
</Layout>
