---
import Layout from "../../layouts/Layout.astro";
import ServiceSidebar from "../../components/services/ServiceSidebar.astro";
import { SERVICES_CONTENT } from "../../data/constants";
import { QuoteModal } from "../../components/react/Modals";

export function getStaticPaths() {
  return Object.keys(SERVICES_CONTENT).map((slug) => ({
    params: { slug },
  }));
}

const { slug } = Astro.params;
const content = SERVICES_CONTENT[slug as string];

if (!content) {
  return Astro.redirect("/services");
}

const siteUrl = Astro.site?.href || "https://astro-blog-five-zeta.vercel.app";
const web3formsKey = import.meta.env.PUBLIC_WEB3FORMS_KEY || "";
---

<Layout
  title={content.title}
  description={`${content.headline} ${content.subhead}`}
>
  <Fragment slot="head">
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "Service",
      "name": content.title,
      "description": content.subhead,
      "provider": {
        "@type": "Organization",
        "name": "Unicalibre Estimating",
        "url": siteUrl
      }
    })} />
    <script type="application/ld+json" set:html={JSON.stringify({
      "@context": "https://schema.org",
      "@type": "BreadcrumbList",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "name": "Home", "item": siteUrl },
        { "@type": "ListItem", "position": 2, "name": "Services", "item": `${siteUrl}services` },
        { "@type": "ListItem", "position": 3, "name": content.title, "item": Astro.url.href }
      ]
    })} />
  </Fragment>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 lg:py-24">
    <div class="flex flex-col lg:flex-row gap-12">
      <ServiceSidebar activeSlug={slug} />

      <div class="flex-1 space-y-12">
        <!-- Header -->
        <div>
          <nav class="flex items-center gap-2 text-sm text-slate-500 mb-6">
            <a href="/" class="hover:text-primary transition-colors">Home</a>
            <span>/</span>
            <a href="/services" class="hover:text-primary transition-colors">Services</a>
            <span>/</span>
            <span class="text-slate-700">{content.title}</span>
          </nav>
          <h1 class="text-3xl md:text-4xl font-bold text-slate-900 mb-4">{content.headline}</h1>
          <p class="text-xl text-primary font-medium">{content.subhead}</p>
        </div>

        <!-- Problem & Solution -->
        <div class="space-y-8">
          <div>
            <h2 class="text-xl font-bold text-slate-900 mb-3">The Problem</h2>
            <p class="text-slate-600 leading-relaxed">{content.painPoints}</p>
          </div>

          <div>
            <h2 class="text-xl font-bold text-slate-900 mb-3">Our Solution</h2>
            <p class="text-slate-600 leading-relaxed">{content.solution}</p>
          </div>
        </div>

        <!-- What's Included -->
        {content.included && (
          <div class="bg-slate-50 p-8 rounded-xl border border-slate-100">
            <h2 class="text-xl font-bold text-slate-900 mb-6">What's Included</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              {content.included.map((item: string) => (
                <div class="flex items-start gap-3">
                  <svg class="w-5 h-5 text-primary shrink-0 mt-0.5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                  <span class="text-slate-700">{item}</span>
                </div>
              ))}
            </div>
          </div>
        )}

        <!-- Materials -->
        {content.materials && (
          <div>
            <h2 class="text-lg font-bold text-slate-900 mb-4">Materials / Projects</h2>
            <p class="text-slate-600 p-4 bg-white border border-slate-200 rounded-lg">
              {content.materials}
            </p>
          </div>
        )}

        <!-- CTA -->
        <div class="pt-8">
          <QuoteModal client:load web3formsKey={web3formsKey} />
        </div>
      </div>
    </div>
  </div>
</Layout>
